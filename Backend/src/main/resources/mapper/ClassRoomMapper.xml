<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.classroom.ClassRoomMapper">

    <select id="selectMyClassRooms"
            resultType="com.example.demo.classroom.ClassRoomVO">

        <!-- 내가 방장인 방 -->
        SELECT
        r.room_id AS roomId,
        r.title   AS title,

        r.host_user_email AS hostUserEmail,

        1 AS isHost,

        CONCAT(
        DATE_FORMAT(r.start_date, '%Y년 %m월 %d일'),
        ' ~ ',
        DATE_FORMAT(r.ended_at, '%Y년 %m월 %d일')
        ) AS date,

        r.room_img AS roomImg

        FROM room r
        WHERE r.host_user_email = #{email}

        UNION ALL

        <!-- 내가 참가 신청했고 승인된 방 -->
        SELECT
        r.room_id AS roomId,
        r.title   AS title,

        r.host_user_email AS hostUserEmail,

        0 AS isHost,

        CONCAT(
        DATE_FORMAT(r.start_date, '%Y년 %m월 %d일'),
        ' ~ ',
        DATE_FORMAT(r.ended_at, '%Y년 %m월 %d일')
        ) AS date,

        r.room_img AS roomImg

        FROM room_join_request j
        JOIN room r
        ON j.room_id = r.room_id

        WHERE j.request_user_email = #{email}
        AND j.status = '승인'

        ORDER BY date DESC

    </select>

</mapper>
